<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Vaccination Coverage Over Time</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            background-color: #2f1b0c;
            color: #fff3e0;
            font-family: Arial, sans-serif;
            text-align: center;
        }

        h1 {
            margin-top: 20px;
        }

        .dropdowns {
            margin: 20px auto;
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        select {
            padding: 10px;
            border: none;
            border-radius: 10px;
            background-color: #ffab40;
            color: #2f1b0c;
            font-size: 16px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: background-color 0.3s;
        }

        select:hover {
            background-color: #ff9100;
        }

        .chart {
            display: flex;
            justify-content: center;
            margin-top: 30px;
        }

        .bar {
            fill: #ff6d00;
        }

        .axis text {
            fill: #fff3e0;
        }

        .axis path,
        .axis line {
            stroke: #fff3e0;
        }
    </style>
</head>
<body>

<h1>Vaccination Coverage Over Time</h1>

<div class="dropdowns">
    <label for="vaccineSelect">Vaccine:</label>
    <select id="vaccineSelect"></select>

    <label for="geoSelect">Geography:</label>
    <select id="geoSelect"></select>
</div>

<div class="chart">
    <svg width="800" height="500"></svg>
</div>

<script>
    d3.csv("Vaccination_Coverage_among_Adolescents__13-17_Years__20250520.csv").then(function(data) {
        data.forEach(d => {
            d['Estimate (%)'] = +d['Estimate (%)'];
            d['Survey Year'] = +d['Survey Year'];
        });

        const svg = d3.select("svg");
        const margin = {top: 30, right: 30, bottom: 30, left: 100};
        const width = +svg.attr("width") - margin.left - margin.right;
        const height = +svg.attr("height") - margin.top - margin.bottom;
        const g = svg.append("g").attr("transform", `translate(${margin.left},${margin.top})`);

        const vaccines = Array.from(new Set(data.map(d => d['Vaccine/Sample']))).sort();
        const geographies = Array.from(new Set(data.map(d => d['Geography']))).sort();

        const vaccineSelect = d3.select("#vaccineSelect");
        vaccineSelect.selectAll("option")
            .data(vaccines)
            .enter()
            .append("option")
            .text(d => d)
            .attr("value", d => d);

        const geoSelect = d3.select("#geoSelect");
        geoSelect.selectAll("option")
            .data(geographies)
            .enter()
            .append("option")
            .text(d => d)
            .attr("value", d => d);

        function updateChart() {
            const selectedVaccine = vaccineSelect.node().value;
            const selectedGeo = geoSelect.node().value;

            const filteredData = data.filter(d =>
                d['Vaccine/Sample'] === selectedVaccine && d['Geography'] === selectedGeo);

            const nested = d3.rollup(filteredData, v => d3.mean(v, d => d['Estimate (%)']), d => d['Survey Year']);
            const years = Array.from(nested.keys()).sort((a, b) => a - b);
            const estimates = years.map(year => ({year, estimate: nested.get(year)}));

            g.selectAll("*").remove();

            const y = d3.scaleBand()
                .domain(years)
                .range([0, height])
                .padding(0.2);

            const x = d3.scaleLinear()
                .domain([0, d3.max(estimates, d => d.estimate) || 100])
                .range([0, width]);

            g.append("g")
                .attr("class", "axis")
                .call(d3.axisLeft(y).tickFormat(d3.format("d")));

            g.append("g")
                .attr("transform", `translate(0,${height})`)
                .attr("class", "axis")
                .call(d3.axisBottom(x).ticks(10).tickFormat(d => d + "%"));

            g.selectAll(".bar")
                .data(estimates)
                .enter()
                .append("rect")
                .attr("class", "bar")
                .attr("y", d => y(d.year))
                .attr("x", 0)
                .attr("height", y.bandwidth())
                .attr("width", d => x(d.estimate));
        }

        updateChart();
        vaccineSelect.on("change", updateChart);
        geoSelect.on("change", updateChart);
    });
</script>

</body>
</html>
